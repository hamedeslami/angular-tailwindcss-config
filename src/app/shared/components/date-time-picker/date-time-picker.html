<div class="relative" #pickerContainer>
  <!-- Input Field -->
  <div class="relative">
    <input
      [value]="displayValue"
      (click)="togglePicker()"
      [placeholder]="placeholder"
      [disabled]="disabled"
      readonly
      class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rtl:text-right rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500 cursor-pointer"
      [class.opacity-50]="disabled"
    />

    <!-- Calendar Icon -->
    <div
      class="absolute inset-y-0 ltr:right-0 rtl:left-0 flex items-center ltr:pr-3 rtl:pl-3 pointer-events-none"
    >
      <svg
        class="w-4 h-4 text-gray-500 dark:text-gray-400"
        aria-hidden="true"
        xmlns="http://www.w3.org/2000/svg"
        fill="currentColor"
        viewBox="0 0 20 20"
      >
        <path
          d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"
        />
      </svg>
    </div>

    @if(selectedDate && !disabled){
    <button
      (click)="clearSelection(); $event.stopPropagation()"
      class="absolute ltr:right-8 rtl:left-8 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors"
      type="button"
    >
      <svg
        class="w-4 h-4"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M6 18L18 6M6 6l12 12"
        />
      </svg>
    </button>
    }
  </div>

  <!-- Main Picker Dropdown -->
  @if(showPicker){
  <div
    class="absolute top-full ltr:left-0 rtl:right-0 mt-1 z-50 bg-white rounded-lg shadow-lg dark:bg-gray-700 border border-gray-200 dark:border-gray-600 min-w-80"
  >
    <!-- Date Picker Section -->
    @if(mode === 'date' || mode === 'both'){ @if(currentView === 'calendar') {
    <app-calendar
      [currentMonth]="currentMonth"
      [selectedDate]="selectedDate"
      [minDate]="minDate"
      [maxDate]="maxDate"
      (dateSelected)="onDateSelected($event)"
      (viewChange)="onViewChange($event)"
    >
    </app-calendar>
    } @if(currentView === 'month') {
    <app-month-selector
      (monthSelected)="onMonthSelected($event)"
      (backToCalendar)="backToCalendar()"
    >
    </app-month-selector>
    } @if(currentView === 'year') {
    <app-year-selector
      [currentMonth]="currentMonth"
      (yearSelected)="onYearSelected($event)"
      (backToCalendar)="backToCalendar()"
    >
    </app-year-selector>
    }

    <!-- Today Button -->
    @if(currentView === 'calendar') {
    <div class="flex justify-center mt-4 pb-4">
      <button
        (click)="selectToday()"
        type="button"
        class="px-4 py-2 text-sm font-medium text-blue-600 cursor-pointer hover:text-blue-700 dark:text-blue-500 dark:hover:text-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-200 dark:focus:ring-blue-800 rounded-lg"
      >
        {{ isRTL ? 'امروز' : 'Today' }}
      </button>
    </div>
    } }

    <!-- Time Picker Section -->
    @if((mode === 'time' || mode === 'both') && (mode === 'time' ||
    showTimeSection)){
    <app-time-picker
      [selectedTime]="selectedTime"
      [is24Hour]="is24Hour"
      (timeSelected)="onTimeSelected($event)"
      (timeFormatToggled)="onTimeFormatToggled()"
    >
    </app-time-picker>

    <!-- Done Button for time picker in 'both' mode -->
    @if(mode === 'both'){
    <div class="flex justify-center mt-4 pb-4">
      <button
        (click)="closePicker()"
        type="button"
        class="px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-lg"
      >
        {{ isRTL ? 'انجام' : 'Done' }}
      </button>
    </div>
    } }

    <!-- Show Time Button for 'both' mode when time section is hidden -->
    @if(mode === 'both' && !showTimeSection && currentView === 'calendar'){
    <div class="border-t border-gray-200 dark:border-gray-600 p-4">
      <button
        (click)="showTimeSection = true"
        type="button"
        class="w-full px-4 py-2 text-sm font-medium text-blue-600 hover:text-blue-700 dark:text-blue-500 dark:hover:text-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-200 dark:focus:ring-blue-800 rounded-lg"
      >
        {{ isRTL ? 'انتخاب زمان' : 'Select Time' }}
      </button>
    </div>
    }
  </div>
  }
</div>
